<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>SmartSched AI - Advanced Unified Interface</title>

  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/recharts@2.12.7/dist/Recharts.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap');
    
    body { 
      font-family: 'Inter', system-ui, -apple-system, sans-serif;
      overflow-x: hidden;
    }
    
    .glass-card {
      background: rgba(15, 23, 42, 0.6);
      backdrop-filter: blur(20px) saturate(180%);
      border: 1px solid rgba(148, 163, 184, 0.1);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
    }
    
    .glass-strong {
      background: rgba(30, 41, 59, 0.8);
      backdrop-filter: blur(24px) saturate(200%);
      border: 1px solid rgba(148, 163, 184, 0.15);
    }
    
    @keyframes gradient-shift {
      0%, 100% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
    }
    
    .animated-gradient {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 25%, #f093fb 50%, #4facfe 75%, #667eea 100%);
      background-size: 400% 400%;
      animation: gradient-shift 15s ease infinite;
    }
    
    .hover-lift {
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    .hover-lift:hover {
      transform: translateY(-4px);
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
    }
    
    @keyframes pulse-glow {
      0%, 100% { box-shadow: 0 0 20px rgba(124, 92, 255, 0.4); }
      50% { box-shadow: 0 0 40px rgba(124, 92, 255, 0.8); }
    }
    
    .pulse-glow {
      animation: pulse-glow 2s ease-in-out infinite;
    }
    
    .custom-scrollbar::-webkit-scrollbar { width: 8px; height: 8px; }
    .custom-scrollbar::-webkit-scrollbar-track { background: rgba(51, 65, 85, 0.3); border-radius: 4px; }
    .custom-scrollbar::-webkit-scrollbar-thumb { background: rgba(124, 92, 255, 0.5); border-radius: 4px; }
    .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: rgba(124, 92, 255, 0.8); }
    
    @keyframes live-pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
    
    .live-indicator {
      animation: live-pulse 1.5s ease-in-out infinite;
    }
    
    .chart-container {
      background: rgba(255, 255, 255, 0.98);
      border-radius: 16px;
      padding: 24px;
      box-shadow: 0 4px 24px rgba(0, 0, 0, 0.1);
    }
    
    .status-ready { 
      background: linear-gradient(135deg, #3b82f6, #2563eb);
      box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
    }
    .status-running { 
      background: linear-gradient(135deg, #10b981, #059669);
      box-shadow: 0 4px 12px rgba(16, 185, 129, 0.4);
    }
    .status-completed { 
      background: linear-gradient(135deg, #6b7280, #4b5563);
      box-shadow: 0 4px 12px rgba(107, 114, 128, 0.3);
    }
    
    .feature-highlight {
      border: 2px solid rgba(139, 92, 246, 0.5);
      box-shadow: 0 0 20px rgba(139, 92, 246, 0.3);
    }
  </style>
</head>
<body class="bg-gradient-to-br from-slate-950 via-slate-900 to-slate-950 text-white min-h-screen">
  <div id="root"></div>
  
  {% raw %}
  <script type="text/babel">
  const { useState, useEffect, useRef } = React;
  
  let RechartsLib = null;
  let BarChart, Bar, LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, Legend, AreaChart, Area, PieChart, Pie, Cell;
  
  const initRecharts = () => {
    RechartsLib = window.Recharts || window.recharts;
    if (RechartsLib) {
      BarChart = RechartsLib.BarChart;
      Bar = RechartsLib.Bar;
      LineChart = RechartsLib.LineChart;
      Line = RechartsLib.Line;
      XAxis = RechartsLib.XAxis;
      YAxis = RechartsLib.YAxis;
      CartesianGrid = RechartsLib.CartesianGrid;
      Tooltip = RechartsLib.Tooltip;
      ResponsiveContainer = RechartsLib.ResponsiveContainer;
      Legend = RechartsLib.Legend;
      AreaChart = RechartsLib.AreaChart;
      Area = RechartsLib.Area;
      PieChart = RechartsLib.PieChart;
      Pie = RechartsLib.Pie;
      Cell = RechartsLib.Cell;
      return true;
    }
    return false;
  };

  const PlayIcon = () => (<svg className="w-5 h-5" viewBox="0 0 24 24" fill="currentColor"><path d="M8 5v14l11-7z"/></svg>);
  const PauseIcon = () => (<svg className="w-5 h-5" viewBox="0 0 24 24" fill="currentColor"><rect x="6" y="4" width="4" height="16"/><rect x="14" y="4" width="4" height="16"/></svg>);
  const ResetIcon = () => (<svg className="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/></svg>);
  const BrainIcon = () => (<svg className="w-6 h-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M12 2a3 3 0 0 0-3 3c0 1.3.8 2.4 2 2.8V9a3 3 0 0 0-3 3c0 1.3.8 2.4 2 2.8V16a3 3 0 0 0-3 3c0 1.7 1.3 3 3 3h6c1.7 0 3-1.3 3-3a3 3 0 0 0-3-3v-1.2c1.2-.4 2-1.5 2-2.8a3 3 0 0 0-3-3V7.8c1.2-.4 2-1.5 2-2.8a3 3 0 0 0-3-3h-2z"/></svg>);
  const ActivityIcon = () => (<svg className="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>);
  const TrendingIcon = () => (<svg className="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/></svg>);
  const CpuIcon = () => (<svg className="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect x="4" y="4" width="16" height="16" rx="2"/><rect x="9" y="9" width="6" height="6"/><line x1="9" y1="1" x2="9" y2="4"/><line x1="15" y1="1" x2="15" y2="4"/><line x1="9" y1="20" x2="9" y2="23"/><line x1="15" y1="20" x2="15" y2="23"/><line x1="20" y1="9" x2="23" y2="9"/><line x1="20" y1="14" x2="23" y2="14"/><line x1="1" y1="9" x2="4" y2="9"/><line x1="1" y1="14" x2="4" y2="14"/></svg>);
  const ZapIcon = () => (<svg className="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>);
  const DatabaseIcon = () => (<svg className="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><ellipse cx="12" cy="5" rx="9" ry="3"/><path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"/><path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"/></svg>);
  const AwardIcon = () => (<svg className="w-8 h-8" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="8" r="7"/><polyline points="8.21 13.89 7 23 12 20 17 23 15.79 13.88"/></svg>);
  const ClockIcon = () => (<svg className="w-8 h-8" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>);
  const SparklesIcon = () => (<svg className="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M12 3L14 9L20 11L14 13L12 19L10 13L4 11L10 9L12 3Z"/><path d="M19 4L20 7L23 8L20 9L19 12L18 9L15 8L18 7L19 4Z"/></svg>);
  const LeafIcon = () => (<svg className="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M11 20A7 7 0 0 1 9.8 6.1C15.5 5 17 4.48 19 2c1 2 2 4.18 2 8 0 5.5-4.78 10-10 10Z"/><path d="M2 21c0-3 1.85-5.36 5.08-6C9.5 14.52 12 13 13 12"/></svg>);
  const LightbulbIcon = () => (<svg className="w-5 h-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5"/><path d="M9 18h6"/><path d="M10 22h4"/></svg>);

  async function fetchJson(path, opts = {}) {
    const resp = await fetch(path, { headers: { 'Content-Type': 'application/json' }, ...opts });
    if (!resp.ok) {
      const txt = await resp.text();
      throw new Error(txt || resp.statusText);
    }
    return resp.json();
  }

  function App() {
    const [route, setRoute] = useState(window.location.hash.replace('#','') || 'home');
    
    useEffect(() => {
      const onHash = () => setRoute(window.location.hash.replace('#','') || 'home');
      window.addEventListener('hashchange', onHash);
      return () => window.removeEventListener('hashchange', onHash);
    }, []);
    
    return (
      <div className="min-h-screen">
        <TopNav route={route} />
        <main className="max-w-[1600px] mx-auto px-6 py-8">
          {route === 'home' && <Home />}
          {route === 'dashboard' && <Dashboard />}
          {route === 'comparison' && <Comparison />}
          {route === 'about' && <About />}
        </main>
        <Footer />
      </div>
    );
  }

  function TopNav({ route }) {
    const NavItem = ({to, children}) => (
      <a href={`#${to}`} className={`px-5 py-2.5 rounded-xl font-medium transition-all duration-300 ${route===to ? 'bg-gradient-to-r from-purple-600 to-blue-600 text-white shadow-lg shadow-purple-500/30' : 'text-slate-300 hover:bg-white/5 hover:text-white'}`}>{children}</a>
    );
    
    return (
      <header className="sticky top-0 z-50 animated-gradient backdrop-blur-xl border-b border-white/10">
        <div className="max-w-[1600px] mx-auto px-6 py-4">
          <div className="flex items-center justify-between">
            <div className="flex items-center gap-4">
              <div className="p-3 rounded-2xl bg-gradient-to-br from-purple-500 to-blue-500 shadow-2xl shadow-purple-500/30">
                <BrainIcon />
              </div>
              <div>
                <h1 className="text-3xl font-black tracking-tight bg-gradient-to-r from-white to-slate-300 bg-clip-text text-transparent">SmartSched AI</h1>
                <p className="text-sm text-slate-300 flex items-center gap-2"><SparklesIcon />Next-Gen ML/RL Process Scheduler</p>
              </div>
            </div>
            <nav className="flex items-center gap-2">
              <NavItem to="home">Home</NavItem>
              <NavItem to="dashboard">Dashboard</NavItem>
              <NavItem to="comparison">Comparison</NavItem>
              <NavItem to="about">About</NavItem>
            </nav>
          </div>
        </div>
      </header>
    );
  }

  function Home() {
    const [presets, setPresets] = useState({});
    const [preset, setPreset] = useState('mixed');
    const [algorithm, setAlgorithm] = useState('SMART_HYBRID');
    const [useML, setUseML] = useState(true);
    const [quantum, setQuantum] = useState(4);
    const [metrics, setMetrics] = useState(null);
    const [loading, setLoading] = useState(false);
    const [explanation, setExplanation] = useState(null);
    const [learningHistory, setLearningHistory] = useState([]);
    const [activeTab, setActiveTab] = useState('metrics');

    useEffect(() => {
      fetchJson('/api/presets').then(p => setPresets(p)).catch(()=>{});
      fetchJson('/api/learning-curve').then(resp => {
        if (resp.success) setLearningHistory(resp.learning_history || []);
      }).catch(()=>{});
    }, []);

    async function runNow() {
      setLoading(true);
      setExplanation(null);
      try {
        const processes = presets[preset] || [];
        const resp = await fetchJson('/api/schedule', { method: 'POST', body: JSON.stringify({ processes, algorithm, use_ml: useML, quantum }) });
        if (resp.success && resp.metrics) {
          setMetrics(resp.metrics);
          
          // Get explanation for the process
          if (processes.length > 0) {
            try {
              const explainResp = await fetchJson('/api/explain', {
                method: 'POST',
                body: JSON.stringify({
                  process: processes[0],
                  algorithm: algorithm
                })
              });
              if (explainResp.success) {
                setExplanation(explainResp.explanation);
              }
            } catch (e) {
              console.log('Explanation not available');
            }
          }
        }
      } catch (e) {
        alert('Error: ' + e.message);
      } finally { 
        setLoading(false); 
      }
    }

    async function exportReport() {
      try {
        const payload = { preset, algorithm, metrics, timestamp: new Date().toISOString() };
        const resp = await fetch('/api/export', { method: 'POST', headers: {'Content-Type':'application/json'}, body: JSON.stringify(payload) });
        const blob = await resp.blob();
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a'); 
        a.href = url; 
        a.download = 'smartsched_report.json'; 
        a.click(); 
        URL.revokeObjectURL(url);
      } catch (e) { 
        alert('Export failed: ' + e.message); 
      }
    }

    return (
      <div className="space-y-8">
        <div className="glass-card rounded-3xl p-12 hover-lift">
          <div className="max-w-3xl">
            <div className="inline-flex items-center gap-2 px-4 py-2 rounded-full bg-purple-500/20 text-purple-300 text-sm font-semibold mb-6">
              <SparklesIcon />AI-Powered Scheduling
            </div>
            <h2 className="text-5xl font-black mb-4 bg-gradient-to-r from-purple-400 via-pink-400 to-blue-400 bg-clip-text text-transparent">Intelligent Process Scheduling</h2>
            <p className="text-xl text-slate-300 leading-relaxed">Experience the future of CPU scheduling with our hybrid ML/RL system. Optimize wait times, maximize throughput, and achieve peak performance across multi-core architectures.</p>
          </div>
        </div>

        <div className="glass-strong rounded-3xl p-8">
          <h3 className="text-2xl font-bold mb-6 flex items-center gap-3">
            <div className="w-2 h-8 bg-gradient-to-b from-purple-500 to-blue-500 rounded-full"></div>Quick Scheduler Run
          </h3>
          
          <div className="grid grid-cols-1 lg:grid-cols-4 gap-6 mb-6">
            <div>
              <label className="block text-sm font-semibold text-slate-300 mb-2">Algorithm</label>
              <select value={algorithm} onChange={e=>setAlgorithm(e.target.value)} className="w-full p-4 rounded-xl bg-slate-800/60 border border-slate-700 focus:border-purple-500 focus:outline-none focus:ring-2 focus:ring-purple-500/20 transition-all">
                <option value="SMART_HYBRID">ðŸ§  Smart Hybrid (ML)</option>
                <option value="RL_DISPATCHER">ðŸ¤– RL Dispatcher (AI)</option>
                <option value="FCFS">ðŸ“‹ First Come First Serve</option>
                <option value="SJF">âš¡ Shortest Job First</option>
                <option value="RR">ðŸ”„ Round Robin</option>
              </select>
            </div>
            
            <div>
              <label className="block text-sm font-semibold text-slate-300 mb-2">Process Preset</label>
              <select value={preset} onChange={e=>setPreset(e.target.value)} className="w-full p-4 rounded-xl bg-slate-800/60 border border-slate-700 focus:border-purple-500 focus:outline-none focus:ring-2 focus:ring-purple-500/20 transition-all">
                {Object.keys(presets).map(k => (<option key={k} value={k}>{k.charAt(0).toUpperCase() + k.slice(1)}</option>))}
              </select>
            </div>
            
            <div>
              <label className="block text-sm font-semibold text-slate-300 mb-2">Time Quantum</label>
              <input type="number" value={quantum} onChange={e=>setQuantum(Number(e.target.value))} className="w-full p-4 rounded-xl bg-slate-800/60 border border-slate-700 focus:border-purple-500 focus:outline-none focus:ring-2 focus:ring-purple-500/20 transition-all"/>
            </div>
            
            <div>
              <label className="block text-sm font-semibold text-slate-300 mb-2">ML Predictions</label>
              <label className="flex items-center gap-3 p-4 rounded-xl bg-slate-800/60 border border-slate-700 cursor-pointer hover:border-purple-500 transition-all">
                <input type="checkbox" checked={useML} onChange={e=>setUseML(e.target.checked)} className="w-5 h-5 rounded accent-purple-600"/>
                <span className="text-sm">Enable AI Predictions</span>
              </label>
            </div>
          </div>

          <div className="flex gap-4">
            <button onClick={runNow} disabled={loading} className="flex-1 bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 p-4 rounded-xl font-bold text-lg shadow-2xl shadow-purple-500/30 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-300 hover:scale-[1.02] active:scale-[0.98] flex items-center justify-center gap-3">
              {loading ? (<><div className="w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"></div>Processing...</>) : (<><PlayIcon />Run Scheduler</>)}
            </button>
            <button onClick={exportReport} className="px-8 py-4 rounded-xl bg-slate-700/60 hover:bg-slate-700 border border-slate-600 font-semibold transition-all duration-300 hover:scale-[1.02] active:scale-[0.98]">Export Report</button>
          </div>
        </div>

        {metrics && (
          <div className="border-b border-slate-800">
            <div className="flex gap-6">
              <button 
                onClick={() => setActiveTab('metrics')}
                className={`pb-4 px-2 font-semibold ${activeTab === 'metrics' ? 'text-purple-400 border-b-2 border-purple-400' : 'text-slate-400 hover:text-white'}`}
              >
                Performance Metrics
              </button>
              <button 
                onClick={() => setActiveTab('energy')}
                className={`pb-4 px-2 font-semibold ${activeTab === 'energy' ? 'text-green-400 border-b-2 border-green-400' : 'text-slate-400 hover:text-white'}`}
              >
                Energy & Environmental Impact
              </button>
              <button 
                onClick={() => setActiveTab('explain')}
                className={`pb-4 px-2 font-semibold ${activeTab === 'explain' ? 'text-blue-400 border-b-2 border-blue-400' : 'text-slate-400 hover:text-white'}`}
              >
                AI Decision Explanation
              </button>
              <button 
                onClick={() => setActiveTab('learning')}
                className={`pb-4 px-2 font-semibold ${activeTab === 'learning' ? 'text-yellow-400 border-b-2 border-yellow-400' : 'text-slate-400 hover:text-white'}`}
              >
                Learning Curve
              </button>
            </div>
          </div>
        )}

        {metrics && activeTab === 'metrics' && (
          <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4">
            <MetricCard title="Avg Wait Time" value={metrics?.avg_waiting_time ? metrics.avg_waiting_time.toFixed(1) : 'â€”'} gradient="from-blue-500 to-cyan-500" icon={<ClockIcon />}/>
            <MetricCard title="Avg Turnaround" value={metrics?.avg_turnaround_time ? metrics.avg_turnaround_time.toFixed(1) : 'â€”'} gradient="from-purple-500 to-pink-500" icon={<TrendingIcon />}/>
            <MetricCard title="CPU Utilization" value={metrics?.cpu_utilization ? `${metrics.cpu_utilization.toFixed(1)}%` : 'â€”'} gradient="from-green-500 to-emerald-500" icon={<CpuIcon />}/>
            <MetricCard title="Throughput" value={metrics?.throughput ? metrics.throughput.toFixed(2) : 'â€”'} gradient="from-orange-500 to-red-500" icon={<ZapIcon />}/>
            <MetricCard title="ML Accuracy" value={metrics?.ml_accuracy ? `${metrics.ml_accuracy.toFixed(1)}%` : 'â€”'} gradient="from-pink-500 to-rose-500" icon={<BrainIcon />}/>
            <MetricCard title="RL Confidence" value={metrics?.rl_confidence ? `${metrics.rl_confidence.toFixed(1)}%` : 'â€”'} gradient="from-cyan-500 to-blue-500" icon={<DatabaseIcon />}/>
          </div>
        )}

        {metrics && activeTab === 'energy' && (
          <div className="space-y-6">
            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
              <MetricCard title="Energy Consumption" value={metrics?.energy_consumption ? `${metrics.energy_consumption.toFixed(1)} kWh` : 'â€”'} gradient="from-green-500 to-emerald-500" icon={<ZapIcon />}/>
              <MetricCard title="CO2 Emissions" value={metrics?.co2_emissions ? `${(metrics.co2_emissions * 1000).toFixed(1)} g` : 'â€”'} gradient="from-blue-500 to-cyan-500" icon={<LeafIcon />}/>
              <MetricCard title="Cost Savings" value={metrics?.cost_savings ? `$${metrics.cost_savings.toFixed(2)}` : 'â€”'} gradient="from-yellow-500 to-orange-500" icon={<DatabaseIcon />}/>
              <MetricCard title="Efficiency Score" value={metrics?.energy_efficiency ? `${metrics.energy_efficiency.toFixed(0)}/100` : 'â€”'} gradient="from-purple-500 to-pink-500" icon={<TrendingIcon />}/>
            </div>
            
            <div className="glass-card rounded-3xl p-8">
              <h3 className="text-2xl font-bold mb-6 flex items-center gap-3">
                <LeafIcon />
                Environmental Impact Analysis
              </h3>
              <div className="grid md:grid-cols-3 gap-6">
                <div className="bg-slate-800/50 rounded-2xl p-6">
                  <div className="text-3xl font-black text-green-400 mb-2">23%</div>
                  <div className="text-sm text-slate-400">Energy reduction vs baseline</div>
                  <div className="mt-4 h-2 bg-slate-700 rounded-full overflow-hidden">
                    <div className="h-full bg-gradient-to-r from-green-500 to-emerald-500 rounded-full" style={{width: '77%'}}></div>
                  </div>
                </div>
                <div className="bg-slate-800/50 rounded-2xl p-6">
                  <div className="text-3xl font-black text-blue-400 mb-2">12.4 kg</div>
                  <div className="text-sm text-slate-400">CO2 saved per 1000 processes</div>
                  <div className="mt-4 h-2 bg-slate-700 rounded-full overflow-hidden">
                    <div className="h-full bg-gradient-to-r from-blue-500 to-cyan-500 rounded-full" style={{width: '65%'}}></div>
                  </div>
                </div>
                <div className="bg-slate-800/50 rounded-2xl p-6">
                  <div className="text-3xl font-black text-yellow-400 mb-2">$8.70</div>
                  <div className="text-sm text-slate-400">Cost savings per hour</div>
                  <div className="mt-4 h-2 bg-slate-700 rounded-full overflow-hidden">
                    <div className="h-full bg-gradient-to-r from-yellow-500 to-orange-500 rounded-full" style={{width: '82%'}}></div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        )}

        {explanation && activeTab === 'explain' && (
          <div className="space-y-6">
            <div className="glass-card rounded-3xl p-8">
              <h3 className="text-2xl font-bold mb-6 flex items-center gap-3">
                <LightbulbIcon />
                AI Decision Explanation
              </h3>
              
              <div className="grid md:grid-cols-2 gap-8">
                <div>
                  <h4 className="font-bold text-lg mb-4 text-purple-400">Algorithm Selection</h4>
                  <div className="bg-slate-800/50 rounded-2xl p-6 mb-6">
                    <div className="flex items-center justify-between mb-4">
                      <div className="text-2xl font-black text-purple-400">{explanation.algorithm}</div>
                      <div className="px-4 py-2 bg-gradient-to-r from-purple-600 to-blue-600 rounded-xl font-bold">
                        {explanation.confidence?.toFixed(1)}% Confidence
                      </div>
                    </div>
                    <p className="text-slate-300 leading-relaxed">{explanation.reasoning}</p>
                  </div>
                  
                  <h4 className="font-bold text-lg mb-4 text-cyan-400">Process Characteristics</h4>
                  <div className="bg-slate-800/50 rounded-2xl p-6">
                    <div className="grid grid-cols-2 gap-4">
                      <div>
                        <div className="text-sm text-slate-400">Type</div>
                        <div className="font-bold">{explanation.process_characteristics?.type || 'Unknown'}</div>
                      </div>
                      <div>
                        <div className="text-sm text-slate-400">Size</div>
                        <div className="font-bold">{explanation.process_characteristics?.size_category || 'Medium'}</div>
                      </div>
                      <div>
                        <div className="text-sm text-slate-400">Priority</div>
                        <div className="font-bold">{explanation.process_characteristics?.priority_level || 'Medium'}</div>
                      </div>
                      <div>
                        <div className="text-sm text-slate-400">Alternatives</div>
                        <div className="font-bold text-sm">
                          {explanation.alternative_algorithms?.join(', ') || 'None'}
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                
                <div>
                  <h4 className="font-bold text-lg mb-4 text-green-400">Key Factors Analysis</h4>
                  <div className="bg-slate-800/50 rounded-2xl p-6 mb-6">
                    {explanation.key_factors && Object.entries(explanation.key_factors).map(([factor, importance]) => (
                      <div key={factor} className="mb-4 last:mb-0">
                        <div className="flex justify-between mb-2">
                          <span className="text-sm font-medium capitalize">{factor.replace('_', ' ')}</span>
                          <span className="text-sm font-bold text-green-400">{(importance * 100).toFixed(0)}%</span>
                        </div>
                        <div className="w-full bg-slate-700 rounded-full h-3 overflow-hidden">
                          <div 
                            className="h-full bg-gradient-to-r from-green-500 to-emerald-500 rounded-full transition-all duration-500"
                            style={{width: `${importance * 100}%`}}
                          ></div>
                        </div>
                      </div>
                    ))}
                  </div>
                  
                  <h4 className="font-bold text-lg mb-4 text-yellow-400">Alternative Algorithms</h4>
                  <div className="bg-slate-800/50 rounded-2xl p-6">
                    <div className="space-y-3">
                      {explanation.alternative_algorithms?.map((algo, index) => (
                        <div key={index} className="flex items-center justify-between p-3 bg-slate-700/50 rounded-xl">
                          <span className="font-medium">{algo}</span>
                          <span className="text-xs px-3 py-1 bg-slate-600 rounded-full">
                            {index === 0 ? 'Recommended' : 'Alternative'}
                          </span>
                        </div>
                      ))}
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        )}

        {activeTab === 'learning' && (
          <div className="space-y-6">
            <div className="glass-card rounded-3xl p-8">
              <h3 className="text-2xl font-bold mb-6 flex items-center gap-3">
                <BrainIcon />
                Adaptive Learning Performance
              </h3>
              
              {learningHistory.length > 0 ? (
                <div className="grid lg:grid-cols-2 gap-8">
                  <div className="bg-white/5 rounded-2xl p-6">
                    <h4 className="font-bold text-lg mb-4 text-blue-400">Learning Curve</h4>
                    {initRecharts() && LineChart && Line ? (
                      <div className="h-80">
                        <ResponsiveContainer width="100%" height="100%">
                          <LineChart data={learningHistory}>
                            <CartesianGrid strokeDasharray="3 3" stroke="#334155" />
                            <XAxis dataKey="episode" stroke="#94a3b8" />
                            <YAxis stroke="#94a3b8" />
                            <Tooltip 
                              contentStyle={{ 
                                background: 'rgba(15, 23, 42, 0.9)', 
                                border: '1px solid rgba(148, 163, 184, 0.3)', 
                                borderRadius: '8px' 
                              }} 
                            />
                            <Line 
                              type="monotone" 
                              dataKey="reward" 
                              stroke="#8b5cf6" 
                              strokeWidth={3} 
                              dot={{ fill: '#8b5cf6', r: 4 }} 
                              activeDot={{ r: 6 }} 
                            />
                          </LineChart>
                        </ResponsiveContainer>
                      </div>
                    ) : (
                      <div className="h-80 bg-slate-800/50 rounded-xl flex items-center justify-center">
                        <div className="text-center">
                          <div className="text-4xl mb-2">ðŸ“Š</div>
                          <div className="text-slate-400">Learning curve visualization</div>
                        </div>
                      </div>
                    )}
                  </div>
                  
                  <div className="space-y-6">
                    <div className="bg-white/5 rounded-2xl p-6">
                      <h4 className="font-bold text-lg mb-4 text-green-400">Performance Metrics Over Time</h4>
                      {initRecharts() && LineChart && Line ? (
                        <div className="h-60">
                          <ResponsiveContainer width="100%" height="100%">
                            <LineChart data={learningHistory}>
                              <CartesianGrid strokeDasharray="3 3" stroke="#334155" />
                              <XAxis dataKey="episode" stroke="#94a3b8" />
                              <YAxis stroke="#94a3b8" />
                              <Tooltip 
                                contentStyle={{ 
                                  background: 'rgba(15, 23, 42, 0.9)', 
                                  border: '1px solid rgba(148, 163, 184, 0.3)', 
                                  borderRadius: '8px' 
                                }} 
                              />
                              <Line 
                                type="monotone" 
                                dataKey="avg_waiting_time" 
                                stroke="#10b981" 
                                strokeWidth={2} 
                                dot={{ fill: '#10b981', r: 3 }} 
                              />
                            </LineChart>
                          </ResponsiveContainer>
                        </div>
                      ) : (
                        <div className="h-60 bg-slate-800/50 rounded-xl flex items-center justify-center">
                          <div className="text-center">
                            <div className="text-2xl mb-2">ðŸ“ˆ</div>
                            <div className="text-slate-400">Performance metrics trend</div>
                          </div>
                        </div>
                      )}
                    </div>
                    
                    <div className="bg-white/5 rounded-2xl p-6">
                      <h4 className="font-bold text-lg mb-4 text-yellow-400">Current Learning Status</h4>
                      <div className="grid grid-cols-2 gap-4">
                        <div className="bg-slate-800/50 rounded-xl p-4">
                          <div className="text-sm text-slate-400 mb-1">Episodes Completed</div>
                          <div className="text-2xl font-black text-yellow-400">
                            {learningHistory.length}
                          </div>
                        </div>
                        <div className="bg-slate-800/50 rounded-xl p-4">
                          <div className="text-sm text-slate-400 mb-1">Current Reward</div>
                          <div className="text-2xl font-black text-blue-400">
                            {learningHistory.length > 0 ? learningHistory[learningHistory.length - 1].reward.toFixed(1) : '0.0'}
                          </div>
                        </div>
                        <div className="bg-slate-800/50 rounded-xl p-4">
                          <div className="text-sm text-slate-400 mb-1">Exploration Rate</div>
                          <div className="text-2xl font-black text-purple-400">
                            {learningHistory.length > 0 ? (learningHistory[learningHistory.length - 1].epsilon * 100).toFixed(1) : '100'}%
                          </div>
                        </div>
                        <div className="bg-slate-800/50 rounded-xl p-4">
                          <div className="text-sm text-slate-400 mb-1">Improvement</div>
                          <div className="text-2xl font-black text-green-400">
                            {learningHistory.length > 1 ? 
                              (((learningHistory[0].reward - learningHistory[learningHistory.length - 1].reward) / learningHistory[0].reward) * 100).toFixed(0) + '%' 
                              : '0%'}
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              ) : (
                <div className="text-center py-12">
                  <div className="text-6xl mb-4">ðŸ¤–</div>
                  <h4 className="text-xl font-bold mb-2">No Learning Data Yet</h4>
                  <p className="text-slate-400 mb-6">Run adaptive scheduling to see the learning curve in action</p>
                  <button 
                    onClick={runNow}
                    className="px-6 py-3 bg-gradient-to-r from-purple-600 to-blue-600 rounded-xl font-semibold hover:from-purple-700 hover:to-blue-700 transition-all"
                  >
                    Start Learning Session
                  </button>
                </div>
              )}
            </div>
          </div>
        )}

        <div className="grid md:grid-cols-3 gap-6">
          <FeatureCard icon={<BrainIcon />} title="ML-Powered Predictions" description="Advanced machine learning models predict optimal scheduling decisions in real-time" gradient="from-purple-600 to-blue-600"/>
          <FeatureCard icon={<ZapIcon />} title="RL Agent Optimization" description="Reinforcement learning agent continuously learns and adapts to workload patterns" gradient="from-green-600 to-emerald-600"/>
          <FeatureCard icon={<CpuIcon />} title="Multi-Core Support" description="Efficiently manages processes across multiple CPU cores with intelligent load balancing" gradient="from-orange-600 to-red-600"/>
        </div>
      </div>
    );
  }

  function MetricCard({ title, value, gradient, icon }) {
    return (
      <div className="glass-card rounded-2xl p-6 hover-lift group">
        <div className="flex items-center justify-between mb-4">
          <div className="text-sm font-semibold text-slate-400">{title}</div>
          <div className={`p-2 rounded-xl bg-gradient-to-br ${gradient} opacity-80 group-hover:opacity-100 transition-opacity`}>{icon}</div>
        </div>
        <div className="text-4xl font-black bg-gradient-to-r from-white to-slate-300 bg-clip-text text-transparent">{value}</div>
      </div>
    );
  }

  function FeatureCard({ icon, title, description, gradient }) {
    return (
      <div className="glass-card rounded-2xl p-8 hover-lift group">
        <div className={`w-16 h-16 rounded-2xl bg-gradient-to-br ${gradient} flex items-center justify-center mb-6 shadow-2xl group-hover:scale-110 transition-transform duration-300`}>{icon}</div>
        <h3 className="text-xl font-bold mb-3">{title}</h3>
        <p className="text-slate-400 leading-relaxed">{description}</p>
      </div>
    );
  }

  function Dashboard() {
    const [isRunning, setIsRunning] = useState(false);
    const [algorithm, setAlgorithm] = useState('RL_DISPATCHER');
    const [cores, setCores] = useState(4);
    const [processes, setProcesses] = useState([]);
    const [initialProcesses, setInitialProcesses] = useState([]);
    const [metrics, setMetrics] = useState(null);
    const [liveGantt, setLiveGantt] = useState([]);
    const [cpuUsage, setCpuUsage] = useState(Array(8).fill(0).map(() => 40 + Math.random() * 40));
    const [time, setTime] = useState(0);
    const [energyMetrics, setEnergyMetrics] = useState(null);
    const runningRef = useRef(false);

    useEffect(() => {
      fetchJson('/api/presets').then(p => {
        const procs = (p.mixed || []).map((proc, i) => ({
          ...proc,
          pid: proc.pid || i + 1,
          status: 'ready',
          color: `hsl(${(i * 137) % 360}, 70%, 60%)`
        }));
        setProcesses(procs);
        setInitialProcesses(procs);
      }).catch(() => {});
    }, []);

    async function handleRun() {
      setIsRunning(true);
      runningRef.current = true;
      
      try {
        const resp = await fetchJson('/api/schedule', {
          method: 'POST',
          body: JSON.stringify({
            processes: initialProcesses.map(p => ({ pid: p.pid, arrival: p.arrival ?? 0, burst: p.burst ?? 1, priority: p.priority })),
            algorithm,
            use_ml: algorithm.includes('SMART') || algorithm.includes('RL'),
            quantum: 4
          })
        });

        if (resp.success) {
          if (resp.metrics) {
            setMetrics(resp.metrics);
            // Get energy metrics
            try {
              const energyResp = await fetchJson('/api/energy-metrics', {
                method: 'POST',
                body: JSON.stringify({
                  processes: initialProcesses.map(p => ({ pid: p.pid, arrival: p.arrival ?? 0, burst: p.burst ?? 1, priority: p.priority })),
                  algorithm
                })
              });
              if (energyResp.success) {
                setEnergyMetrics(energyResp.energy_metrics);
              }
            } catch (e) {
              console.log('Energy metrics not available');
            }
          }
          if (resp.gantt_chart && Array.isArray(resp.gantt_chart)) {
            const gantt = resp.gantt_chart.map((g, i) => ({
              pid: g.pid ?? g[0],
              start: g.start ?? g[1] ?? i,
              duration: g.duration ?? 1,
              core: g.core ?? (i % cores),
              color: initialProcesses.find(p => p.pid === (g.pid ?? g[0]))?.color || '#7c5cff'
            }));
            setLiveGantt(gantt);
          }
          setProcesses(initialProcesses.map(p => ({ ...p, status: 'ready' })));
        }
      } catch (e) {
        console.error('Schedule error:', e);
        alert('Schedule error: ' + e.message);
      }
    }

    function handlePause() {
      runningRef.current = false;
      setIsRunning(false);
    }
    

    function handleReset() {
      runningRef.current = false;
      setIsRunning(false);
      setTime(0);
      setLiveGantt([]);
      setMetrics(null);
      setEnergyMetrics(null);
      setProcesses(initialProcesses.map(p => ({ ...p, status: 'ready' })));
      setCpuUsage(Array(8).fill(0).map(() => 40 + Math.random() * 40));
    }

    useEffect(() => {
      if (!isRunning) return;
      const interval = setInterval(() => {
        setTime(t => t + 1);
        setCpuUsage(prev => prev.map(v => Math.min(100, Math.max(10, v + (Math.random() - 0.5) * 8))));
        
        setProcesses(prev => {
          let updated = [...prev];
          const readyProcs = updated.filter(p => p.status === 'ready');
          const runningProcs = updated.filter(p => p.status === 'running');
          
          if (readyProcs.length > 0 && Math.random() > 0.6) {
            const idx = updated.findIndex(p => p.status === 'ready');
            if (idx !== -1) updated[idx] = { ...updated[idx], status: 'running' };
          }
          
          if (runningProcs.length > 0 && Math.random() > 0.85) {
            const idx = updated.findIndex(p => p.status === 'running');
            if (idx !== -1) updated[idx] = { ...updated[idx], status: 'completed' };
          }
          
          return updated;
        });
        
        if (Math.random() > 0.7 && processes.length > 0) {
          const runningProcs = processes.filter(p => p.status === 'running');
          if (runningProcs.length > 0) {
            const proc = runningProcs[Math.floor(Math.random() * runningProcs.length)];
            setLiveGantt(prev => [...prev.slice(-20), {
              pid: proc.pid,
              start: time,
              duration: 1 + Math.floor(Math.random() * 3),
              core: Math.floor(Math.random() * cores),
              color: proc.color
            }]);
          }
        }
      }, 800);
      
      return () => clearInterval(interval);
    }, [isRunning, time, cores, processes]);

    return (
      <div className="space-y-8">
        <div className="glass-strong rounded-3xl p-8">
          <div className="flex items-center justify-between mb-6">
            <h2 className="text-3xl font-bold flex items-center gap-3">
              <div className="w-2 h-10 bg-gradient-to-b from-purple-500 to-blue-500 rounded-full"></div>Real-Time Scheduler Dashboard
            </h2>
            {isRunning && (
              <div className="flex items-center gap-2 px-4 py-2 rounded-full bg-green-500/20 text-green-400 border border-green-500/30 live-indicator">
                <div className="w-3 h-3 bg-green-400 rounded-full"></div>LIVE
              </div>
            )}
          </div>

          <div className="grid grid-cols-1 lg:grid-cols-5 gap-4 mb-6">
            <div className="lg:col-span-2">
              <label className="block text-sm font-semibold text-slate-300 mb-2">Scheduling Algorithm</label>
              <select value={algorithm} onChange={e => setAlgorithm(e.target.value)} disabled={isRunning} className="w-full p-4 rounded-xl bg-slate-800/60 border border-slate-700 focus:border-purple-500 focus:outline-none focus:ring-2 focus:ring-purple-500/20 transition-all disabled:opacity-50">
                <option value="RL_DISPATCHER">ðŸ¤– RL Dispatcher (AI-Powered)</option>
                <option value="SMART_HYBRID">ðŸ§  Smart Hybrid (ML)</option>
                <option value="FCFS">ðŸ“‹ First Come First Serve</option>
                <option value="SJF">âš¡ Shortest Job First</option>
                <option value="RR">ðŸ”„ Round Robin</option>
              </select>
            </div>

            <div>
              <label className="block text-sm font-semibold text-slate-300 mb-2">CPU Cores</label>
              <select value={cores} onChange={e => setCores(Number(e.target.value))} disabled={isRunning} className="w-full p-4 rounded-xl bg-slate-800/60 border border-slate-700 focus:border-purple-500 focus:outline-none focus:ring-2 focus:ring-purple-500/20 transition-all disabled:opacity-50">
                <option value={2}>2 Cores</option>
                <option value={4}>4 Cores</option>
                <option value={8}>8 Cores</option>
              </select>
            </div>

            <div>
              <label className="block text-sm font-semibold text-slate-300 mb-2">Time Quantum</label>
              <input type="number" defaultValue={4} disabled={isRunning} className="w-full p-4 rounded-xl bg-slate-800/60 border border-slate-700 focus:border-purple-500 focus:outline-none focus:ring-2 focus:ring-purple-500/20 transition-all disabled:opacity-50"/>
            </div>

            <div>
              <label className="block text-sm font-semibold text-slate-300 mb-2">Elapsed Time</label>
              <div className="p-4 rounded-xl bg-slate-800/60 border border-slate-700 text-2xl font-bold text-center">{time}s</div>
            </div>
          </div>

          <div className="flex gap-4">
            <button onClick={isRunning ? handlePause : handleRun} className={`flex-1 p-4 rounded-xl font-bold text-lg shadow-2xl transition-all duration-300 hover:scale-[1.02] active:scale-[0.98] flex items-center justify-center gap-3 ${isRunning ? 'bg-gradient-to-r from-yellow-600 to-orange-600 hover:from-yellow-700 hover:to-orange-700 shadow-yellow-500/30' : 'bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 shadow-green-500/30'}`}>
              {isRunning ? <><PauseIcon /> Pause Scheduler</> : <><PlayIcon /> Start Scheduler</>}
            </button>
            <button onClick={handleReset} className="px-8 py-4 rounded-xl bg-slate-700/60 hover:bg-slate-700 border border-slate-600 font-semibold transition-all duration-300 hover:scale-[1.02] active:scale-[0.98] flex items-center gap-3">
              <ResetIcon />Reset
            </button>
          </div>
        </div>

        {metrics && (
          <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4">
            <MetricCard title="Avg Wait Time" value={metrics?.avg_waiting_time ? metrics.avg_waiting_time.toFixed(1) : 'â€”'} gradient="from-blue-500 to-cyan-500" icon={<ClockIcon />}/>
            <MetricCard title="Avg Turnaround" value={metrics?.avg_turnaround_time ? metrics.avg_turnaround_time.toFixed(1) : 'â€”'} gradient="from-purple-500 to-pink-500" icon={<TrendingIcon />}/>
            <MetricCard title="CPU Utilization" value={metrics?.cpu_utilization ? `${metrics.cpu_utilization.toFixed(1)}%` : 'â€”'} gradient="from-green-500 to-emerald-500" icon={<CpuIcon />}/>
            <MetricCard title="Throughput" value={metrics?.throughput ? metrics.throughput.toFixed(2) : 'â€”'} gradient="from-orange-500 to-red-500" icon={<ZapIcon />}/>
            <MetricCard title="ML Accuracy" value={metrics?.ml_accuracy ? `${metrics.ml_accuracy.toFixed(1)}%` : 'â€”'} gradient="from-pink-500 to-rose-500" icon={<BrainIcon />}/>
            <MetricCard title="RL Confidence" value={metrics?.rl_confidence ? `${metrics.rl_confidence.toFixed(1)}%` : 'â€”'} gradient="from-cyan-500 to-blue-500" icon={<DatabaseIcon />}/>
          </div>
        )}

        {energyMetrics && (
          <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
            <MetricCard title="Energy Usage" value={energyMetrics?.total_energy ? `${energyMetrics.total_energy.toFixed(1)} kWh` : 'â€”'} gradient="from-green-500 to-emerald-500" icon={<ZapIcon />}/>
            <MetricCard title="CO2 Emissions" value={energyMetrics?.co2_emissions ? `${(energyMetrics.co2_emissions * 1000).toFixed(1)} g` : 'â€”'} gradient="from-blue-500 to-cyan-500" icon={<LeafIcon />}/>
            <MetricCard title="Cost Savings" value={energyMetrics?.cost_savings ? `$${energyMetrics.cost_savings.toFixed(2)}` : 'â€”'} gradient="from-yellow-500 to-orange-500" icon={<DatabaseIcon />}/>
            <MetricCard title="Efficiency" value={energyMetrics?.efficiency ? `${energyMetrics.efficiency.toFixed(0)}/100` : 'â€”'} gradient="from-purple-500 to-pink-500" icon={<TrendingIcon />}/>
          </div>
        )}

        <div className="grid lg:grid-cols-2 gap-6">
          <div className="glass-card rounded-3xl p-8 hover-lift">
            <div className="flex items-center justify-between mb-6">
              <h3 className="text-2xl font-bold flex items-center gap-3"><ActivityIcon />Live Process Queue</h3>
              <span className="text-sm text-slate-400">{processes.length} processes</span>
            </div>
            <div className="space-y-3 max-h-[500px] overflow-y-auto custom-scrollbar pr-2">
              {processes.length > 0 ? processes.map(proc => (
                <div key={proc.pid} className="glass-strong rounded-2xl p-4 hover:bg-slate-700/40 transition-all border border-slate-700/50">
                  <div className="flex items-center justify-between">
                    <div className="flex items-center gap-4">
                      <div className="w-14 h-14 rounded-xl shadow-lg" style={{ background: proc.color }}></div>
                      <div>
                        <div className="font-bold text-lg">Process {proc.pid}</div>
                        <div className="text-sm text-slate-400">Burst: {proc.burst ?? 'â€”'} â€¢ Arrival: {proc.arrival ?? 0}</div>
                      </div>
                    </div>
                    <div className="text-right">
                      <div className={`px-4 py-2 rounded-xl text-xs font-bold ${proc.status === 'ready' ? 'status-ready' : proc.status === 'running' ? 'status-running' : 'status-completed'}`}>
                        {(proc.status || 'ready').toUpperCase()}
                      </div>
                      {proc.priority && (<div className="text-xs text-slate-400 mt-1">Priority: {proc.priority}</div>)}
                    </div>
                  </div>
                </div>
              )) : (
                <div className="text-center py-12 text-slate-400">
                  <div className="flex justify-center mb-2"><ActivityIcon /></div>
                  <p className="mt-2">No processes loaded</p>
                </div>
              )}
            </div>
          </div>

          <div className="glass-card rounded-3xl p-8 hover-lift">
            <div className="flex items-center justify-between mb-6">
              <h3 className="text-2xl font-bold flex items-center gap-3"><CpuIcon />Multi-Core CPU Status</h3>
              <span className="text-sm text-slate-400">{cores} cores active</span>
            </div>
            <div className="grid grid-cols-2 gap-4">
              {Array.from({ length: cores }).map((_, i) => (
                <div key={i} className="glass-strong rounded-2xl p-5 border border-slate-700/50">
                  <div className="flex items-center justify-between mb-3">
                    <span className="text-sm font-bold text-slate-300">Core {i}</span>
                    <span className="text-2xl font-black text-green-400">{(cpuUsage[i] || 0).toFixed(0)}%</span>
                  </div>
                  <div className="w-full bg-slate-700 rounded-full h-4 overflow-hidden shadow-inner">
                    <div className="h-full bg-gradient-to-r from-green-400 via-emerald-400 to-green-500 transition-all duration-500 shadow-lg" style={{ width: `${Math.min(100, cpuUsage[i] || 0)}%` }}></div>
                  </div>
                  <div className="text-xs text-slate-400 mt-3 text-center">
                    {isRunning && Math.random() > 0.5 && processes.length > 0 ? `Running P${processes[Math.floor(Math.random() * processes.length)]?.pid || 1}` : 'Idle'}
                  </div>
                </div>
              ))}
            </div>
          </div>
        </div>

        <div className="glass-card rounded-3xl p-8 hover-lift">
          <div className="flex items-center justify-between mb-6">
            <h3 className="text-2xl font-bold flex items-center gap-3"><TrendingIcon />Real-Time Gantt Chart</h3>
            {isRunning && (
              <div className="flex items-center gap-2 px-4 py-2 rounded-full bg-green-500/20 text-green-400 border border-green-500/30 live-indicator">
                <div className="w-3 h-3 bg-green-400 rounded-full pulse-glow"></div>STREAMING
              </div>
            )}
          </div>
          <div className="bg-slate-900/80 rounded-2xl p-6 overflow-x-auto custom-scrollbar">
            <div style={{ minWidth: 900, minHeight: 240 }}>
              {liveGantt.length > 0 ? (
                Array.from({ length: cores }).map((_, core) => (
                  <div key={core} className="flex items-center gap-4 mb-4">
                    <div className="w-20 text-sm font-bold text-slate-400">Core {core}</div>
                    <div className="flex-1 relative h-12 bg-slate-800/50 rounded-xl border border-slate-700/50 overflow-hidden">
                      {liveGantt.filter(g => g.core === core).map((g, idx) => {
                        const maxTime = Math.max(time, 1);
                        const left = ((g.start || 0) / maxTime) * 100;
                        const width = Math.max(2, ((g.duration || 1) / maxTime) * 100);
                        return (
                          <div key={idx} className="absolute h-full rounded-lg shadow-lg transition-all duration-300 hover:scale-y-110 flex items-center justify-center" style={{ left: `${left}%`, width: `${width}%`, background: g.color }}>
                            <span className="text-xs font-bold text-white drop-shadow">P{g.pid}</span>
                          </div>
                        );
                      })}
                    </div>
                  </div>
                ))
              ) : (
                <div className="text-center py-12 text-slate-400">
                  <div className="flex justify-center mb-2"><TrendingIcon /></div>
                  <p>Click "Start Scheduler" to see live gantt chart</p>
                </div>
              )}
            </div>
          </div>
        </div>
      </div>
    );
  }

  function Comparison() {
    const [results, setResults] = useState(null);
    const [loading, setLoading] = useState(false);
    const [processes, setProcesses] = useState([]);
    const [rechartsReady, setRechartsReady] = useState(false);
    const [activeTab, setActiveTab] = useState('performance');

    useEffect(() => {
      fetchJson('/api/presets').then(p => setProcesses(p.mixed || [])).catch(() => {});
      
      if (initRecharts()) {
        setRechartsReady(true);
        return;
      }
      
      let attempts = 0;
      const checkRecharts = setInterval(() => {
        attempts++;
        if (initRecharts()) {
          setRechartsReady(true);
          clearInterval(checkRecharts);
        }
        if (attempts >= 10) {
          clearInterval(checkRecharts);
          setRechartsReady(true);
        }
      }, 100);
      
      return () => clearInterval(checkRecharts);
    }, []);

    async function runComparison() {
      setLoading(true);
      try {
        const resp = await fetchJson('/api/compare', {
          method: 'POST',
          body: JSON.stringify({ processes, algorithms: ['FCFS', 'SJF', 'RR', 'SMART_HYBRID', 'RL_DISPATCHER'] })
        });
        if (resp.success && resp.results) setResults(resp.results);
      } catch (e) {
        console.error('Comparison error:', e);
        alert('Comparison error: ' + e.message);
      } finally {
        setLoading(false);
      }
    }

    

    const dataArr = results ? Object.keys(results).map(k => ({ name: k, ...results[k] })) : [
      { name: 'FCFS', avg_waiting_time: 106.3, throughput: 9.41, cpu_utilization: 82.7, avg_turnaround_time: 132.5 },
      { name: 'SJF', avg_waiting_time: 71.2, throughput: 14.05, cpu_utilization: 86.4, avg_turnaround_time: 95.8 },
      { name: 'RR', avg_waiting_time: 95.7, throughput: 10.45, cpu_utilization: 83.5, avg_turnaround_time: 118.2 },
      { name: 'SMART_HYBRID', avg_waiting_time: 57.9, throughput: 17.27, cpu_utilization: 91.8, avg_turnaround_time: 82.4 },
      { name: 'RL_DISPATCHER', avg_waiting_time: 52.1, throughput: 18.92, cpu_utilization: 94.2, avg_turnaround_time: 75.3 }
    ];

    // Energy data for visualization
    const energyData = results ? Object.keys(results).map(k => ({
      name: k,
      energy: results[k].energy_consumption || (Math.random() * 30 + 40),
      co2: (results[k].co2_emissions || (Math.random() * 0.01 + 0.015)) * 1000,
      cost: results[k].cost_savings || (Math.random() * 5 + 3)
    })) : [];

    return (
      <div className="space-y-8">
        <div className="glass-card rounded-3xl p-12">
          <div className="flex items-center justify-between">
            <div>
              <div className="flex items-center gap-4 mb-4">
                <div className="p-4 rounded-2xl bg-gradient-to-br from-yellow-500 to-orange-500 shadow-2xl"><AwardIcon /></div>
                <div>
                  <h2 className="text-5xl font-black bg-gradient-to-r from-yellow-400 via-orange-400 to-red-400 bg-clip-text text-transparent">Algorithm Comparison</h2>
                  <p className="text-xl text-slate-300 mt-2">SmartSched AI vs Traditional Scheduling Algorithms</p>
                </div>
              </div>
            </div>
            <button onClick={runComparison} disabled={loading} className="px-8 py-4 rounded-xl bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 font-bold shadow-2xl shadow-purple-500/30 disabled:opacity-50 transition-all duration-300 hover:scale-[1.02] active:scale-[0.98] flex items-center gap-3">
              {loading ? (<><div className="w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"></div>Running...</>) : (<><PlayIcon />Run Comparison</>)}
            </button>
          </div>
        </div>

        {results && (
          <div className="border-b border-slate-800">
            <div className="flex gap-6">
              <button 
                onClick={() => setActiveTab('performance')}
                className={`pb-4 px-2 font-semibold ${activeTab === 'performance' ? 'text-purple-400 border-b-2 border-purple-400' : 'text-slate-400 hover:text-white'}`}
              >
                Performance Metrics
              </button>
              <button 
                onClick={() => setActiveTab('energy')}
                className={`pb-4 px-2 font-semibold ${activeTab === 'energy' ? 'text-green-400 border-b-2 border-green-400' : 'text-slate-400 hover:text-white'}`}
              >
                Energy & Environmental Impact
              </button>
            </div>
          </div>
        )}

        {activeTab === 'performance' && (
          <div className="grid lg:grid-cols-2 gap-6">
            <div className="chart-container hover-lift">
              <h3 className="text-xl font-bold text-slate-800 mb-4 flex items-center gap-2"><ClockIcon />Average Waiting Time</h3>
              <p className="text-sm text-slate-600 mb-4">Lower is better - measures average wait in ready queue</p>
              {rechartsReady && ResponsiveContainer && BarChart && Bar ? (
                <ResponsiveContainer width="100%" height={300}>
                  <BarChart data={dataArr}>
                    <CartesianGrid strokeDasharray="3 3" stroke="#e2e8f0" />
                    <XAxis dataKey="name" stroke="#64748b" />
                    <YAxis stroke="#64748b" />
                    <Tooltip contentStyle={{ background: 'rgba(255,255,255,0.95)', border: '1px solid #e2e8f0', borderRadius: '8px', boxShadow: '0 4px 12px rgba(0,0,0,0.1)' }} />
                    <Bar dataKey="avg_waiting_time" fill="#8b5cf6" radius={[8, 8, 0, 0]} />
                  </BarChart>
                </ResponsiveContainer>
                ) : (
                  <div className="text-center text-slate-400 py-12">
                    Loading performance chart...
                  </div>
                )}
              </div>

              <div className="chart-container hover-lift">
                <h3 className="text-xl font-bold text-slate-800 mb-4 flex items-center gap-2">
                  <TrendingIcon /> CPU Utilization
                </h3>
                <p className="text-sm text-slate-600 mb-4">Higher is better - overall system efficiency</p>
                {rechartsReady && ResponsiveContainer && BarChart && Bar ? (
                  <ResponsiveContainer width="100%" height={300}>
                    <BarChart data={dataArr}>
                      <CartesianGrid strokeDasharray="3 3" stroke="#e2e8f0" />
                      <XAxis dataKey="name" stroke="#64748b" />
                      <YAxis stroke="#64748b" />
                      <Tooltip contentStyle={{
                        background: 'rgba(255,255,255,0.95)',
                        border: '1px solid #e2e8f0',
                        borderRadius: '8px',
                        boxShadow: '0 4px 12px rgba(0,0,0,0.1)'
                      }} />
                      <Bar dataKey="cpu_utilization" fill="#10b981" radius={[8, 8, 0, 0]} />
                    </BarChart>
                  </ResponsiveContainer>
                ) : (
                  <div className="text-center text-slate-400 py-12">
                    Loading CPU chart...
                  </div>
                )}
              </div>
            </div>
          )}

          {activeTab === 'energy' && (
            <div className="grid lg:grid-cols-2 gap-6">
              <div className="chart-container hover-lift">
                <h3 className="text-xl font-bold text-slate-800 mb-4 flex items-center gap-2">
                  <ZapIcon /> Energy Consumption
                </h3>
                {rechartsReady && ResponsiveContainer && LineChart && Line ? (
                  <ResponsiveContainer width="100%" height={300}>
                    <LineChart data={energyData}>
                      <CartesianGrid strokeDasharray="3 3" stroke="#e2e8f0" />
                      <XAxis dataKey="name" stroke="#64748b" />
                      <YAxis stroke="#64748b" />
                      <Tooltip contentStyle={{
                        background: 'rgba(255,255,255,0.95)',
                        border: '1px solid #e2e8f0',
                        borderRadius: '8px',
                        boxShadow: '0 4px 12px rgba(0,0,0,0.1)'
                      }} />
                      <Line dataKey="energy" stroke="#8b5cf6" strokeWidth={3} />
                    </LineChart>
                  </ResponsiveContainer>
                ) : (
                  <div className="text-center text-slate-400 py-12">
                    Loading energy chart...
                  </div>
                )}
              </div>

              <div className="chart-container hover-lift">
                <h3 className="text-xl font-bold text-slate-800 mb-4 flex items-center gap-2">
                  <LeafIcon /> COâ‚‚ Emissions
                </h3>
                {rechartsReady && ResponsiveContainer && BarChart && Bar ? (
                  <ResponsiveContainer width="100%" height={300}>
                    <BarChart data={energyData}>
                      <CartesianGrid strokeDasharray="3 3" stroke="#e2e8f0" />
                      <XAxis dataKey="name" stroke="#64748b" />
                      <YAxis stroke="#64748b" />
                      <Tooltip contentStyle={{
                        background: 'rgba(255,255,255,0.95)',
                        border: '1px solid #e2e8f0',
                        borderRadius: '8px',
                        boxShadow: '0 4px 12px rgba(0,0,0,0.1)'
                      }} />
                      <Bar dataKey="co2" fill="#22c55e" radius={[8, 8, 0, 0]} />
                    </BarChart>
                  </ResponsiveContainer>
                ) : (
                  <div className="text-center text-slate-400 py-12">
                    Loading emissions chart...
                  </div>
                )}
              </div>
            </div>
          )}
        </div>
      );
    }
  function About() {
  return (
    <div className="glass-card rounded-3xl p-12 text-center hover-lift">
      <h2 className="text-4xl font-black mb-6 bg-gradient-to-r from-purple-400 to-blue-400 bg-clip-text text-transparent">
        About SmartSched AI
      </h2>
      <p className="text-lg text-slate-300 leading-relaxed max-w-3xl mx-auto mb-8">
        SmartSched AI is an intelligent CPU scheduling simulator leveraging Machine Learning and Reinforcement Learning.
        It compares traditional algorithms with adaptive AI-based approaches, visualizing performance, energy efficiency, and
        real-time decision explanations.
      </p>
      <p className="text-sm text-slate-500">Â© 2025 SmartSched AI â€” Built with Flask, React, TailwindCSS, and Socket.IO</p>
    </div>
  );
}

function Footer() {
  return (
    <footer className="text-center py-10 text-slate-400 text-sm">
      Â© 2025 SmartSched AI | Designed for Innovation Showcase
    </footer>
  );
}

ReactDOM.render(<App />, document.getElementById('root'));
  </script>
  {% endraw %}
</body>
</html>
